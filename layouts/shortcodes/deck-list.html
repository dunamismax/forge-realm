{{- $title := .Get "title" -}} {{- $format := .Get "format" -}} {{- $author :=
.Get "author" -}} {{- $colors := .Get "colors" -}} {{- $strategy := .Get
"strategy" -}} {{- $content := .Inner -}}

<div class="deck-list-container">
  <div class="deck-header">
    <h3 class="deck-title">{{ $title }}</h3>
    <div class="deck-meta">
      {{ if $format }}
      <span class="deck-format">{{ $format }}</span>
      {{ end }} {{ if $author }}
      <span class="deck-author">by {{ $author }}</span>
      {{ end }} {{ if $colors }}
      <div class="deck-colors">
        {{ range split $colors "," }}
        <span class="color-indicator color-{{ . | lower | strings.TrimSpace }}"
          >{{ . | strings.TrimSpace }}</span
        >
        {{ end }}
      </div>
      {{ end }}
    </div>
  </div>

  {{ if $strategy }}
  <div class="deck-strategy">
    <h4>Strategy</h4>
    <p>{{ $strategy }}</p>
  </div>
  {{ end }}

  <div class="deck-content">{{ $content | markdownify }}</div>

  <div class="deck-actions">
    <button class="btn btn-outline-primary btn-sm" onclick="copyDeckList(this)">
      <i class="fa fa-copy"></i> Copy Deck List
    </button>
    <button
      class="btn btn-outline-secondary btn-sm"
      onclick="exportDeckList(this)"
    >
      <i class="fa fa-download"></i> Export
    </button>
  </div>
</div>

<!-- styles moved to SCSS: assets/scss/_styles_project.scss -->

<script>
  function copyDeckList(button) {
    const container = button.closest(".deck-list-container")
    const content = container.querySelector(".deck-content")
    const text = content.innerText

    navigator.clipboard.writeText(text).then(() => {
      const originalText = button.innerHTML
      button.innerHTML = '<i class="fa fa-check"></i> Copied!'
      button.classList.add("btn-success")
      button.classList.remove("btn-outline-primary")

      setTimeout(() => {
        button.innerHTML = originalText
        button.classList.remove("btn-success")
        button.classList.add("btn-outline-primary")
      }, 2000)
    })
  }

  function exportDeckList(button) {
    const container = button.closest(".deck-list-container")
    const title = container.querySelector(".deck-title").innerText
    const content = container.querySelector(".deck-content").innerText

    const blob = new Blob([content], { type: "text/plain" })
    const url = URL.createObjectURL(blob)
    const a = document.createElement("a")
    a.href = url
    a.download = `${title.replace(/[^a-z0-9]/gi, "_").toLowerCase()}.txt`
    a.click()
    URL.revokeObjectURL(url)
  }
</script>
