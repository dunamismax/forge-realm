<!-- Favicon -->
<link rel="icon" href="/favicon.ico" sizes="any" />
<link
  rel="apple-touch-icon"
  href="/images/forge-realm-PNG-circular-emblem.webp"
/>

<!-- Preload critical hero image -->
{{ if .IsHome }}
<link
  rel="preload"
  as="image"
  href="/images/forge-realm-main-wide.webp"
  type="image/webp"
/>
{{ end }}

<!-- Performance optimization meta tags -->
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, shrink-to-fit=no"
/>
<meta name="color-scheme" content="dark light" />

<!-- DNS prefetch for external resources -->
<link rel="dns-prefetch" href="//fonts.googleapis.com" />
<link rel="dns-prefetch" href="//discord.gg" />

<!-- Security and Performance Headers -->
<meta http-equiv="X-Content-Type-Options" content="nosniff" />
<meta http-equiv="X-Frame-Options" content="DENY" />
<meta http-equiv="X-XSS-Protection" content="1; mode=block" />
<meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin" />

<!-- Content Security Policy for enhanced security -->
<meta
  http-equiv="Content-Security-Policy"
  content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self'; media-src 'self'; object-src 'none'; child-src 'none'; worker-src 'none'; frame-ancestors 'none'; base-uri 'self'; form-action 'self'"
/>

<!-- Google Fonts - Optimized by Cloudflare Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap"
  rel="stylesheet"
/>

<!-- Force dark mode defaults even without UI toggle -->
<script>
  ;(function () {
    try {
      var stored =
        localStorage.getItem("td-theme") ||
        localStorage.getItem("docsy.theme") ||
        ""
      var prefersDark = false
      try {
        prefersDark =
          window.matchMedia &&
          window.matchMedia("(prefers-color-scheme: dark)").matches
      } catch (e) {}

      // Default to dark unless user explicitly stored light
      var enableDark = true
      if (stored.toLowerCase() === "light") enableDark = false
      if (stored.toLowerCase() === "dark") enableDark = true
      if (!stored && prefersDark) enableDark = true

      var root = document.documentElement
      if (enableDark) {
        root.classList.add("td-dark-mode")
      } else {
        root.classList.remove("td-dark-mode")
      }

      // Ensure body also gets the class as some styles target body.td-dark-mode
      document.addEventListener("DOMContentLoaded", function () {
        try {
          if (enableDark) document.body.classList.add("td-dark-mode")
          else document.body.classList.remove("td-dark-mode")
        } catch (e) {}
      })
    } catch (e) {
      // Fail safe: prefer dark
      try {
        document.documentElement.classList.add("td-dark-mode")
      } catch (_) {}
      document.addEventListener("DOMContentLoaded", function () {
        try {
          document.body.classList.add("td-dark-mode")
        } catch (_) {}
      })
    }
  })()
</script>

{{ if not .Site.IsServer }}
<!-- Production-only performance optimizations -->
<meta
  http-equiv="Cache-Control"
  content="public, max-age=31536000, immutable"
  data-resource-hint="static"
/>
<link rel="prefetch" href="/docs/" data-resource-hint="likely-navigation" />
<link
  rel="prefetch"
  href="/docs/cards/"
  data-resource-hint="likely-navigation"
/>
{{ end }}

<!-- Custom Code Block Component -->
{{ partial "custom-code-block.html" . }}
