<!-- Custom Code Block Component -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Initialize custom code blocks
    initCustomCodeBlocks()
  })

  function initCustomCodeBlocks() {
    // Find all existing code blocks and enhance them
    const codeBlocks = document.querySelectorAll(
      "pre code, .highlight code, div.code code"
    )

    codeBlocks.forEach(function (codeEl) {
      // Skip if already processed
      if (codeEl.closest(".forge-code-block")) return

      // Get the parent pre or div element
      const parent = codeEl.closest("pre, .highlight, div.code")
      if (!parent) return

      // Create wrapper
      const wrapper = document.createElement("div")
      wrapper.className = "forge-code-block"

      // Create header with copy button
      const header = document.createElement("div")
      header.className = "forge-code-header"

      const copyBtn = document.createElement("button")
      copyBtn.className = "forge-copy-btn"
      copyBtn.innerHTML = `
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="m5 15-4-4v9a2 2 0 0 0 2 2h9l-4-4"></path>
            </svg>
            <span>Copy</span>
        `
      copyBtn.setAttribute("aria-label", "Copy code to clipboard")

      // Add copy functionality
      copyBtn.addEventListener("click", function () {
        const code = codeEl.textContent || codeEl.innerText

        if (navigator.clipboard && window.isSecureContext) {
          // Use modern clipboard API
          navigator.clipboard
            .writeText(code)
            .then(function () {
              showCopyFeedback(copyBtn, true)
            })
            .catch(function () {
              fallbackCopy(code, copyBtn)
            })
        } else {
          fallbackCopy(code, copyBtn)
        }
      })

      header.appendChild(copyBtn)

      // Create content wrapper
      const content = document.createElement("div")
      content.className = "forge-code-content"

      // Insert wrapper before the original element
      parent.parentNode.insertBefore(wrapper, parent)

      // Move the original element into the content wrapper
      content.appendChild(parent)

      // Assemble the structure
      wrapper.appendChild(header)
      wrapper.appendChild(content)

      // Ensure the code element has proper styling
      parent.classList.add("forge-code-pre")
    })
  }

  function fallbackCopy(text, button) {
    // Fallback for older browsers
    const textArea = document.createElement("textarea")
    textArea.value = text
    textArea.style.position = "fixed"
    textArea.style.left = "-9999px"
    textArea.style.top = "-9999px"
    document.body.appendChild(textArea)
    textArea.focus()
    textArea.select()

    try {
      const successful = document.execCommand("copy")
      showCopyFeedback(button, successful)
    } catch (err) {
      showCopyFeedback(button, false)
    }

    document.body.removeChild(textArea)
  }

  function showCopyFeedback(button, success) {
    const originalHtml = button.innerHTML

    if (success) {
      button.innerHTML = `
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="20,6 9,17 4,12"></polyline>
            </svg>
            <span>Copied!</span>
        `
      button.classList.add("copied")
    } else {
      button.innerHTML = `
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="15" y1="9" x2="9" y2="15"></line>
                <line x1="9" y1="9" x2="15" y2="15"></line>
            </svg>
            <span>Failed</span>
        `
      button.classList.add("failed")
    }

    setTimeout(function () {
      button.innerHTML = originalHtml
      button.classList.remove("copied", "failed")
    }, 2000)
  }
</script>

<!-- styles moved to SCSS: assets/scss/_styles_project.scss -->
